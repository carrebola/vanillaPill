"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5411],{3905:(e,o,a)=>{a.d(o,{Zo:()=>d,kt:()=>g});var n=a(7294);function r(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}function t(e,o){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?t(Object(a),!0).forEach((function(o){r(e,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))}))}return e}function l(e,o){if(null==e)return{};var a,n,r=function(e,o){if(null==e)return{};var a,n,r={},t=Object.keys(e);for(n=0;n<t.length;n++)a=t[n],o.indexOf(a)>=0||(r[a]=e[a]);return r}(e,o);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(n=0;n<t.length;n++)a=t[n],o.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var o=n.useContext(s),a=o;return e&&(a="function"==typeof e?e(o):i(i({},o),e)),a},d=function(e){var o=u(e.components);return n.createElement(s.Provider,{value:o},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var o=e.children;return n.createElement(n.Fragment,{},o)}},p=n.forwardRef((function(e,o){var a=e.components,r=e.mdxType,t=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=u(a),p=r,g=c["".concat(s,".").concat(p)]||c[p]||m[p]||t;return a?n.createElement(g,i(i({ref:o},d),{},{components:a})):n.createElement(g,i({ref:o},d))}));function g(e,o){var a=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var t=a.length,i=new Array(t);i[0]=p;var l={};for(var s in o)hasOwnProperty.call(o,s)&&(l[s]=o[s]);l.originalType=e,l[c]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<t;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},9748:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>t,metadata:()=>l,toc:()=>u});var n=a(7462),r=(a(7294),a(3905));const t={sidebar_position:160},i="Historia 14. Sesiones (login/logout)",l={unversionedId:"historias/h14",id:"historias/h14",title:"Historia 14. Sesiones (login/logout)",description:"Como usuario quiero poder abrir y cerrar sesi\xf3n y ver el email del usuario cuando est\xe1 logueado",source:"@site/docs/historias/h14.md",sourceDirName:"historias",slug:"/historias/h14",permalink:"/vanillaPill/docs/historias/h14",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/historias/h14.md",tags:[],version:"current",sidebarPosition:160,frontMatter:{sidebar_position:160},sidebar:"tutorialSidebar",previous:{title:"Historia 13. Registro de usuarios",permalink:"/vanillaPill/docs/historias/h13"},next:{title:"Historia 15. Editar mi perfil",permalink:"/vanillaPill/docs/historias/h15"}},s={},u=[{value:"Login",id:"login",level:2},{value:"Logout",id:"logout",level:2},{value:"getUser",id:"getuser",level:2}],d={toc:u},c="wrapper";function m(e){let{components:o,...a}=e;return(0,r.kt)(c,(0,n.Z)({},d,a,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"historia-14-sesiones-loginlogout"},"Historia 14. Sesiones (login/logout)"),(0,r.kt)("p",null,"Como usuario quiero poder abrir y cerrar sesi\xf3n y ver el email del usuario cuando est\xe1 logueado"),(0,r.kt)("h2",{id:"login"},"Login"),(0,r.kt)("p",null,"En primer lugar crearemos una rama ",(0,r.kt)("strong",{parentName:"p"},"login")," para separar esta feature de la rama principal hasta tener terminado la funcionalidad"),(0,r.kt)("p",null,"Vamos ahora a la vista ",(0,r.kt)("inlineCode",{parentName:"p"},"loginVista.js")," donde tenemos el template de la vista y a\xf1adimos el m\xe9todo script() para programar la l\xf3gica asociada a este componente."),(0,r.kt)("p",null,"Para poder realizar el login necesitamos capturar el formulario y detectar su evento ",(0,r.kt)("strong",{parentName:"p"},"submit")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="loginVista.js"',title:'"loginVista.js"'},"const form = document.querySelector('#login')\nform.addEventListener('submit', async (event) => {\n    event.preventDefault()\n})\n        \n")),(0,r.kt)("p",null," Ahora crearemos un objeto userData con los datos del formulario. Para crear la sesi\xf3n utilizaremos el m\xe9todo login de nuestra clase User ",(0,r.kt)("inlineCode",{parentName:"p"},"User.login(userData)")," (No olvidemos que antes debemos importar nuestra clase con ",(0,r.kt)("inlineCode",{parentName:"p"},"import { User } from '../bd/user'"),")\nSi se produce un error en el login lo gestionaremos con try/catch\nEste ser\xeda el c\xf3digo por el momento:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title = "loginVista.js"',title:!0,"":"",'"loginVista.js"':!0},"const form = document.querySelector('#login')\nform.addEventListener('submit', async (event) => {\n   event.preventDefault()\n   try {\n       // Capturamos datos del formulario\n       const userData = {\n           email: document.querySelector('#email').value,\n           password: document.querySelector('#password').value\n       }\n       // Intentamos loguearnos utilizando el m\xe9todo login de nuestra clase User\n       const usuarioLogeado = await User.login(userData)\n   } catch (error) {\n       alert('No se ha podido iniciar sesi\xf3n ' + error)\n   }\n})\n")),(0,r.kt)("p",null," Ahora solo nos falta, si todo ha ido bien, mostrar en el header y en el men\xfa de usuario ",(0,r.kt)("strong",{parentName:"p"},"el email del usuario logueado")," y, para acabar, cargar la vista ",(0,r.kt)("strong",{parentName:"p"},"home"),"."),(0,r.kt)("p",null," Aprovecharemos tambien para ocultar la opci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"login"),"del men\xfa y mostrar la opci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"logout")," agregando o eliminando la clase ",(0,r.kt)("inlineCode",{parentName:"p"},"d-none"),"de bootstrap."),(0,r.kt)("p",null," El c\xf3digo del m\xe9todo script quedar\xeda as\xed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title = "loginVista.js"',title:!0,"":"",'"loginVista.js"':!0},"script: () => {\n   // script para validaci\xf3n de formulario\n   const form = document.querySelector('#login')\n   form.addEventListener('submit', async (event) => {\n     event.preventDefault()\n     event.stopPropagation()\n     // Verificamos validaci\xf3n del formulario\n     form.classList.add('was-validated')\n     if (!form.checkValidity()) {\n       console.log('formulario no valido')\n     } else {\n       // Si los datos validan\n       try {\n         // Capturamos datos del formulario\n         const userData = {\n           email: document.querySelector('#email').value,\n           password: document.querySelector('#password').value\n         }\n         // Intentamos loguearnos utilizando el m\xe9todo login de nuestra clase User\n         const usuarioLogeado = await User.login(userData)\n         // Si nos logueamos con exito pintamos el email en header y men\xfa de usuario \n         const divUsuarioLogeado = document.querySelectorAll('.emailUsuarioLogueado')\n         divUsuarioLogeado[0].innerHTML = usuarioLogeado.email\n         divUsuarioLogeado[1].innerHTML = usuarioLogeado.email\n         // y ocultamos item 'login' para mostrar item 'logout'\n         document.querySelector('.liLogout').classList.remove('d-none')\n         document.querySelector('.liLogin').classList.add('d-none')\n         // Cagamos la p\xe1gina home\n         window.location.href = '/#/home'\n       } catch (error) {\n         alert('No se ha podido iniciar sesi\xf3n ' + error)\n       }\n     }\n   })\n }\n\n")),(0,r.kt)("h2",{id:"logout"},"Logout"),(0,r.kt)("p",null,"Para poder cerrar sesi\xf3n debemos clicar sobre el item logout del men\xfa de usuario. Primero debemos detectar el evento sobre este item. Esto lo haremos desde el script del componente ",(0,r.kt)("strong",{parentName:"p"},"header")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="header.js"',title:'"header.js"'},"// Capturamos click en item logout de men\xfa de usuario\ndocument.querySelector('.liLogout').addEventListener('click', async () => {\n    \n})\n")),(0,r.kt)("p",null,"Ahora solo tenemos que utilizar el m\xe9todo logout() de User. Como siempre, primero debemos importar la clase User\n",(0,r.kt)("inlineCode",{parentName:"p"},"import { User } from '../bd/user'")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title = "header.js"',title:!0,"":"",'"header.js"':!0},"// Capturamos click en item logout de men\xfa de usuario\ndocument.querySelector('.liLogout').addEventListener('click', async () => {\n    // Cerramos sesi\xf3n utilizando el m\xe9todo de logout de nuestra clase User\n    await User.logout()\n})\n\n")),(0,r.kt)("p",null,"Finalmente, una vez nos hemos cerrado la sesi\xf3n, borramos el email del header y del men\xfa de usuario y mostramos de nuevo el item ",(0,r.kt)("inlineCode",{parentName:"p"},"login")," ocultando el item ",(0,r.kt)("inlineCode",{parentName:"p"},"logout"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title = "header.js"',title:!0,"":"",'"header.js"':!0},"// Capturamos click en item logout de men\xfa de usuario\ndocument.querySelector('.liLogout').addEventListener('click', async () => {\n    // Cerramos sesi\xf3n utilizando el m\xe9todo de logout de nuestra clase User\n    await User.logout()\n    // Borramos de header el email del usuario logueado\n    divUsuarioLogeado[0].innerHTML = ''\n    divUsuarioLogeado[1].innerHTML = ''\n    // y ocultamos la opci\xf3n login del menu del usuario\n    document.querySelector('.liLogout').classList.add('d-none')\n    document.querySelector('.liLogin').classList.remove('d-none')\n})\n\n")),(0,r.kt)("h2",{id:"getuser"},"getUser"),(0,r.kt)("p",null,"Ahora ya solo nos queda verificar si, en el momento en el que entramos en nuestra p\xe1gina web, hay una sesi\xf3n abierta."),(0,r.kt)("p",null,"Podemos crear la l\xf3gica a en el mismo script de header."),(0,r.kt)("p",null,"Para ello llamaremos al m\xe9todo ",(0,r.kt)("inlineCode",{parentName:"p"},"User.getUser()")," el cual nos devuelve los datos del usuario logueado. Si existe este usuario mostraremos, como hicimos al loguearnos, su email en el header y en el men\xfa de usuario"),(0,r.kt)("p",null,"El c\xf3digo final quedar\xeda de la siguiente as\xed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title = "header.js"',title:!0,"":"",'"header.js"':!0},"script: async () => {\n    // Capturamos los datos del usuario logueado\n    const usuarioLogeado = await User.getUser()\n    // Si hay un usuario logueado pintamos el email en el header y en el men\xfa del usuario \n    const divUsuarioLogeado = document.querySelectorAll('.emailUsuarioLogueado')\n    if (usuarioLogeado) {\n      divUsuarioLogeado[0].innerHTML = usuarioLogeado.email\n      divUsuarioLogeado[1].innerHTML = usuarioLogeado.email\n      // y ocultamos la opci\xf3n login del menu del usuario\n      document.querySelector('.liLogin').classList.add('d-none')\n      document.querySelector('.liLogout').classList.remove('d-none')\n    }\n\n    // Capturamos click en logout\n    document.querySelector('.liLogout').addEventListener('click', async () => {\n      // Cerramos sesi\xf3n utilizando el m\xe9todo de logout de nuestra clase User\n      await User.logout()\n      // Borramos de header el email del usuario logueado\n      divUsuarioLogeado[0].innerHTML = ''\n      divUsuarioLogeado[1].innerHTML = ''\n      // y ocultamos la opci\xf3n login del menu del usuario\n      document.querySelector('.liLogout').classList.add('d-none')\n      document.querySelector('.liLogin').classList.remove('d-none')\n    })\n  }\n\n")))}m.isMDXComponent=!0}}]);