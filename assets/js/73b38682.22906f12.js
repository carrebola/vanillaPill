"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1065],{3905:(e,o,a)=>{a.d(o,{Zo:()=>p,kt:()=>f});var t=a(7294);function r(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}function n(e,o){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),a.push.apply(a,t)}return a}function s(e){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?n(Object(a),!0).forEach((function(o){r(e,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))}))}return e}function i(e,o){if(null==e)return{};var a,t,r=function(e,o){if(null==e)return{};var a,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)a=n[t],o.indexOf(a)>=0||(r[a]=e[a]);return r}(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)a=n[t],o.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=t.createContext({}),c=function(e){var o=t.useContext(l),a=o;return e&&(a="function"==typeof e?e(o):s(s({},o),e)),a},p=function(e){var o=c(e.components);return t.createElement(l.Provider,{value:o},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var o=e.children;return t.createElement(t.Fragment,{},o)}},m=t.forwardRef((function(e,o){var a=e.components,r=e.mdxType,n=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(a),m=r,f=d["".concat(l,".").concat(m)]||d[m]||u[m]||n;return a?t.createElement(f,s(s({ref:o},p),{},{components:a})):t.createElement(f,s({ref:o},p))}));function f(e,o){var a=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var n=a.length,s=new Array(n);s[0]=m;var i={};for(var l in o)hasOwnProperty.call(o,l)&&(i[l]=o[l]);i.originalType=e,i[d]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<n;c++)s[c]=a[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},9418:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>n,metadata:()=>i,toc:()=>c});var t=a(7462),r=(a(7294),a(3905));const n={title:"Funciones en Supabase. Las Stored Procedures"},s=void 0,i={unversionedId:"Version 1.0/SPRINT 4 - BACKEND/Probando Supabase con Javascript/Stored Procedures",id:"Version 1.0/SPRINT 4 - BACKEND/Probando Supabase con Javascript/Stored Procedures",title:"Funciones en Supabase. Las Stored Procedures",description:"Vamos a crear funciones de PostgreSQL en supabase.",source:"@site/docs/03-Version 1.0/SPRINT 4 - BACKEND/06-Probando Supabase con Javascript/02-Stored Procedures.md",sourceDirName:"03-Version 1.0/SPRINT 4 - BACKEND/06-Probando Supabase con Javascript",slug:"/Version 1.0/SPRINT 4 - BACKEND/Probando Supabase con Javascript/Stored Procedures",permalink:"/vanillaPill/docs/Version 1.0/SPRINT 4 - BACKEND/Probando Supabase con Javascript/Stored Procedures",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/03-Version 1.0/SPRINT 4 - BACKEND/06-Probando Supabase con Javascript/02-Stored Procedures.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Funciones en Supabase. Las Stored Procedures"},sidebar:"tutorialSidebar",previous:{title:"La API de Javascript de Supabase",permalink:"/vanillaPill/docs/Version 1.0/SPRINT 4 - BACKEND/Probando Supabase con Javascript/API javascript"},next:{title:"Resumen del c\xf3digo JS necesario para la comunicaci\xf3n con la BD",permalink:"/vanillaPill/docs/Version 1.0/SPRINT 4 - BACKEND/Probando Supabase con Javascript/Resumen del codigo js necesario"}},l={},c=[{value:"Funci\xf3n &#39;<em>proyecto_detalle_todos</em>&#39;",id:"funci\xf3n-proyecto_detalle_todos",level:2},{value:"Funci\xf3n <em>proyecto_detalle_todos</em>",id:"funci\xf3n-proyecto_detalle_todos-1",level:3},{value:"Funci\xf3n <em>proyecto_detalle</em>",id:"funci\xf3n-proyecto_detalle",level:2},{value:"Funci\xf3n <em>perfil_detalle</em>",id:"funci\xf3n-perfil_detalle",level:2},{value:"Funci\xf3n <em>perfil_detalle_todos</em>",id:"funci\xf3n-perfil_detalle_todos",level:2}],p={toc:c},d="wrapper";function u(e){let{components:o,...n}=e;return(0,r.kt)(d,(0,t.Z)({},p,n,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Vamos a crear funciones de PostgreSQL en supabase. "),(0,r.kt)("h2",{id:"funci\xf3n-proyecto_detalle_todos"},"Funci\xf3n '",(0,r.kt)("em",{parentName:"h2"},"proyecto_detalle_todos"),"'"),(0,r.kt)("p",null,"La funci\xf3n proyecto_detalle es una funci\xf3n que debe devolvernos todos los campos de la tabla ",(0,r.kt)("em",{parentName:"p"},"proyectos")," y adem\xe1s el ",(0,r.kt)("strong",{parentName:"p"},"nombre")," y los ",(0,r.kt)("strong",{parentName:"p"},"apellidos")," del usuario que ha creado el proyecto."),(0,r.kt)("p",null,"Primero vamos a crear la consulta SQL y vamos a probarla."),(0,r.kt)("p",null,"Nos vamos al panel de consultas SQL de Supabase y escribimos:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT proyectos.*, perfiles.nombre as nombre_usuario, perfiles.apellidos as apellidos_usuario \nFROM proyectos \nINNER JOIN perfiles \nON proyectos.user_id = perfiles.user_id \n")),(0,r.kt)("p",null,"F\xedjate que lo que hacemos es cruzar las tablas ",(0,r.kt)("em",{parentName:"p"},"perfiles")," y ",(0,r.kt)("em",{parentName:"p"},"usuarios")," donde los ",(0,r.kt)("strong",{parentName:"p"},"user_id")," coinciden."),(0,r.kt)("p",null,"Como ya tenemos datos de prueba en las tablas deber\xedamos obtener el siguiente resultado:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"consulta proyecto_detalle",src:a(7292).Z,width:"1348",height:"420"})),(0,r.kt)("p",null,"Ahora que ya sabemos que la consulta es correcta, vamos a crear la funci\xf3n que nos devuelva estos datos. "),(0,r.kt)("p",null,"El c\xf3digo sql para crear esta funci\xf3n es el siguiente:"),(0,r.kt)("h3",{id:"funci\xf3n-proyecto_detalle_todos-1"},"Funci\xf3n ",(0,r.kt)("em",{parentName:"h3"},"proyecto_detalle_todos")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE FUNCTION proyecto_detalle_todos()\nRETURNS TABLE (\n  id integer,\n  user_id UUID,\n  nombre TEXT,\n  descripcion TEXT,\n  imagen TEXT,\n  enlace TEXT,\n  repositorio TEXT,\n  estado TEXT,\n  nombre_usuario TEXT,\n  apellidos_usuario TEXT\n) AS $$\n  SELECT proyectos.id, proyectos.user_id, proyectos.nombre, proyectos.descripcion, proyectos.imagen, proyectos.enlace, proyectos.repositorio, proyectos.estado, perfiles.nombre AS nombre_usuario, perfiles.apellidos AS apellidos_usuario\n  FROM proyectos \n  INNER JOIN perfiles \n  ON proyectos.user_id = perfiles.user_id \n$$ LANGUAGE sql;\n")),(0,r.kt)("p",null,"Si la ejecutamos la respuesta ser\xeda del tipo: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Success. No rows returned\n")),(0,r.kt)("p",null,"Esto significa que la funci\xf3n se ha creado correctamente y que no ha devuelto filas. Es normal, ya que esta consulta lo que hace es crear la funci\xf3n."),(0,r.kt)("p",null,"Si queremos comprobar si se ha creado correctamente podemos ir la opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"database")," del men\xfa vertical izquierdo y hacer click en la opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Functions"),"."),(0,r.kt)("p",null,"Aqu\xed ver\xe1s las funciones que tienes creadas"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"funciones",src:a(5399).Z,width:"1297",height:"763"})),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"En esta captura puedes ver todas mis funciones. En tu proyecto solo deber\xedas ver la que acabas de crear, es decir, ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"proyecto_detalle_todo")),"s")),(0,r.kt)("p",null,"Ahora solo nos falta probar desde el panel de consultas nuestra funci\xf3n. Puedes hacerlo con la consulta:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"select proyecto_detalle_todos()")),(0,r.kt)("p",null,"El resultado deber\xeda ser este:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"proyecto_detalle_todos"\n"(7,1dd53fb9-fa27-4aa3-8c91-2b5de5edba76,""Proyecto de An\xe1lisis de Datos de Marketing"",""Este proyecto permite analizar los datos de marketing de una empresa"",https://imagen.com/analisis-marketing.jpg,https://enlace.com/analisis-marketing,https://github.com/proyecto-analisis-marketing,Inactivo,Gary,Alumno2)"\n"(6,1dd53fb9-fa27-4aa3-8c91-2b5de5edba76,""Proyecto de Visualizaci\xf3n de Datos"",""Este proyecto permite visualizar datos de una empresa"",https://imagen.com/visualizacion-datos.jpg,https://enlace.com/visualizacion-datos,https://github.com/proyecto-visualizacion-datos,Activo,Gary,Alumno2)"\n"(5,1dd53fb9-fa27-4aa3-8c91-2b5de5edba76,""Proyecto de Gesti\xf3n de Proyectos"",""Este proyecto permite gestionar proyectos de una empresa"",https://imagen.com/gestion-proyectos.jpg,https://enlace.com/gestion-proyectos,https://github.com/proyecto-gestion-proyectos,Inactivo,Gary,Alumno2)"\n"(4,1dd53fb9-fa27-4aa3-8c91-2b5de5edba76,""Proyecto de An\xe1lisis de Redes Sociales"",""Este proyecto permite analizar las redes sociales de una empresa"",https://imagen.com/analisis-redes-sociales.jpg,https://enlace.com/analisis-redes-sociales,https://github.com/proyecto-analisis-redes-sociales,Activo,Gary,Alumno2)"\n')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Como podemos observar, los datos se muestran en un formato diferente a una tabla. Cuando usemos la funci\xf3n desde javascript el formato ser\xe1 json, como para el resto de las funciones de la API")),(0,r.kt)("p",null,"Vamos a hacer lo mismo para el resto de funciones. Aqu\xed tienes el c\xf3digo:"),(0,r.kt)("h2",{id:"funci\xf3n-proyecto_detalle"},"Funci\xf3n ",(0,r.kt)("em",{parentName:"h2"},"proyecto_detalle")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="funci\xf3n proyecto_detalle"',title:'"funci\xf3n','proyecto_detalle"':!0},"CREATE FUNCTION proyecto_detalle(proyecto_id integer)\nRETURNS TABLE (\n  id integer,\n  user_id UUID,\n  nombre TEXT,\n  descripcion TEXT,\n  imagen TEXT,\n  enlace TEXT,\n  repositorio TEXT,\n  estado TEXT,\n  nombre_usuario TEXT,\n  apellidos_usuario TEXT\n) AS $$\n  SELECT proyectos.id, proyectos.user_id, proyectos.nombre, proyectos.descripcion, proyectos.imagen, proyectos.enlace, proyectos.repositorio, proyectos.estado, perfiles.nombre AS nombre_usuario, perfiles.apellidos AS apellidos_usuario\n  FROM proyectos \n  INNER JOIN perfiles \n  ON proyectos.user_id = perfiles.user_id \n  WHERE proyectos.id = proyecto_id;\n$$ LANGUAGE sql;\n\n")),(0,r.kt)("h2",{id:"funci\xf3n-perfil_detalle"},"Funci\xf3n ",(0,r.kt)("em",{parentName:"h2"},"perfil_detalle")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="Funci\xf3n perfil_detalle"',title:'"Funci\xf3n','perfil_detalle"':!0},"CREATE FUNCTION perfil_detalle(userid UUID)\nRETURNS TABLE (\n  id integer,\n  created_at timestamp,\n  user_id UUID,\n  nombre TEXT,\n  apellidos TEXT,\n  avatar TEXT,\n  estado TEXT,\n  rol TEXT,\n  email TEXT\n) AS $$\nSELECT perfiles.id, perfiles.created_at, perfiles.user_id, perfiles.nombre, perfiles.apellidos, perfiles.avatar, perfiles.estado, perfiles.rol, auth.users.email\nFROM perfiles \nINNER JOIN auth.users \nON perfiles.user_id = auth.users.id \nWHERE auth.users.id = userid\n$$ LANGUAGE sql;\n")),(0,r.kt)("h2",{id:"funci\xf3n-perfil_detalle_todos"},"Funci\xf3n ",(0,r.kt)("em",{parentName:"h2"},"perfil_detalle_todos")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="funci\xf3n perfil_detalle_todos"',title:'"funci\xf3n','perfil_detalle_todos"':!0},"\nCREATE FUNCTION proyecto_detalle(proyecto_id integer)\nRETURNS TABLE (\n  id integer,\n  user_id UUID,\n  nombre TEXT,\n  descripcion TEXT,\n  imagen TEXT,\n  enlace TEXT,\n  repositorio TEXT,\n  estado TEXT,\n  nombre_usuario TEXT,\n  apellidos_usuario TEXT\n) AS $$\n  SELECT proyectos.id, proyectos.user_id, proyectos.nombre, proyectos.descripcion, proyectos.imagen, proyectos.enlace, proyectos.repositorio, proyectos.estado, perfiles.nombre AS nombre_usuario, perfiles.apellidos AS apellidos_usuario\n  FROM proyectos \n  INNER JOIN perfiles \n  ON proyectos.user_id = perfiles.user_id \n  WHERE proyectos.id = proyecto_id;\n$$ LANGUAGE sql;\n\n")),(0,r.kt)("admonition",{title:"\u270d TAREA \u270d",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Revisa las funciones necesarias para poder implementar todos los m\xe9todos de las clases de nuestro diagrama de clases y cr\xe9alas si es necesario.")))}u.isMDXComponent=!0},7292:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/consulta1-dae62a9e7878b3c50bd9995fa58277df.png"},5399:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/functions-0404f9a114de73d98e1a1919975adfab.png"}}]);