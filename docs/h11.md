---
sidebar_position: 130
---

# Historia 12. Diseño de componentes vanillaJS

Antes de comenzar vamos a trabajar sobre una rama nueva que llamaremos **'vistas'**
## Componente Header
Creamos el archivo `src/header.js` con la estructura de componente que solemos utilizar en vanilla.

```js title="header.js"
export const header = {
  template: '',
  script: ()=>{
    console.log('header)
  }
}
```

Ahora actualizamos la propiedad template con el código de nuestro prototipo. En este caso contendrá una barra de navegación, logotipo, sistema para el login, etc.

...


- Creamos carpeta src/assets
  - logo vanilla
  - imagen avatar
  - iconos (icons8)
    - editar
    - borrar
- Creamos componente header con html y lo insergamos


## Componente Router
Vamos a crear el código neceario para la implementación de un sistema de enrutamiento para una SPA (Single Page Application) en vanilla JavaScript.

En primer lugar vamos a definir un objeto llamado rutas que contiene una lista de todas las rutas de la aplicación y la vista correspondiente a cada una de ellas. Cada ruta está representada por una cadena que indica la dirección de la ruta, y el valor asociado a cada ruta es una promesa que se resolverá con el objeto de la vista correspondiente. Las vistas se importan dinámicamente usando el método import().

```js title="router.js"
// Objeto con todas las rutas y su vista asociada
const rutas = {
  '/': import('../vistas/homeVista.js'),
  '/adminUsuarios': import('../vistas/adminVista.js'),
  '/registro': import('../vistas/registroVista.js'),
  '/login': import('../vistas/loginVista.js')
  //otras vistas
}
```
Ahora creamos la función principal `router`. Esta será la que maneje el enrutamiento en la aplicación. 

Esta función se dispara cada vez que se produce un cambio en la ruta. 

Dentro de esta función, se obtiene la ruta actual del navegador mediante la propiedad `window.location.pathname`. Luego se elimina la extensión .html del final de la ruta utilizando el método **split()**. 

Después, se utiliza la ruta resultante para obtener la vista correspondiente del objeto rutas.

Si la vista existe, se obtiene el objeto de la vista mediante la propiedad **default** de la promesa. 

Luego, se inyecta la vista en el elemento main del documento HTML utilizando la propiedad **innerHTML** de document.querySelector('main'). Por último, se ejecuta el **script** de la vista si lo hay.

Si la vista no existe, se muestra una vista **404** en su lugar.

```js title="router"
// Función que obtiene la ruta del navegador
const router = async (event) => {
  // Capturamos la url
  let path = window.location.pathname
  // eliminamos el '.html'
  path = path.split('.')[0]
  // capturamos el componente con ese nombre de la vista
  const componenteVista = await rutas[path]
  // Si existe la vista la podremos cargar
  try {
    // Obtenemos el objeto del componente
    const vista = await componenteVista.default
    // inyectamos vista y ejecutamos su script
    document.querySelector('main').innerHTML = vista.template
    // vista.script()
  } catch (error) {
    // Si se produce un error cargamos la vista 404
    console.log(error)
    document.querySelector('main').innerHTML = '<h1>404</h1>'
  }
}
```
La función **observadorRutas** es una función que se encarga de escuchar los eventos de enrutamiento en la aplicación. 

En esta función, se capturan los eventos de clic en los enlaces, y se evita que se cargue la página utilizando el método preventDefault(). 

Luego, se obtiene la ruta del enlace utilizando el método **getAttribute('href')**. Se utiliza la función **pushState()** del objeto **history** para agregar la nueva ruta al historial del navegador sin recargar la página. 

Finalmente, se llama a la función **router()** para cargar la nueva vista correspondiente a la ruta.

La función observadorRutas también escucha los eventos **hashchange**, **popstate** y **load** en la ventana del navegador para detectar cambios en la url, y llama a la función router() en respuesta a estos eventos.

De esta manera, podemos crear enlaces utilizando la etiqueta `<a>` y cargar la vista correspondiente, además de habilitar los botones de retroceder y avanzar del navegador.

```js title="router.js"
// Capturamos los eventos
export const observadorRutas = () => {
  // Capturamos eventos de los enlaces
  const links = document.querySelectorAll('a')
  links.forEach(link => {
    link.addEventListener('click', event => {
      // Evitamos que se cargue la página
      event.preventDefault()
      // Obtenemos la ruta del enlace sin el .html
      const href = link.getAttribute('href')
      // Añadimos la nueva ruta al historial
      history.pushState({ path: href }, '', href)
      router()
    })
  })

  //Detectamos los cambios en barra de navegación
  window.addEventListener('hashchange', router)
  window.addEventListener('popstate', router)
  window.addEventListener('load', router)
}
```